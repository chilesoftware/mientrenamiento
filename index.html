<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de INTERÉS y Frecuencia</title>

    <!-- Google Fonts - Oswald y Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS y Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --font-family-headings: 'Oswald', sans-serif;
            --font-family-body: 'Roboto', sans-serif;
            --primary-bg: #f4f7fc;
            --card-bg: #ffffff;
            --text-primary: #2a3547;
            --text-secondary: #6c757d;
            --accent-color: #0d6efd;
            --accent-color-light: #e7f0fe;
            --red: #dc3545;
            --border-radius: 0.75rem;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
        }
        body {
            font-family: var(--font-family-body);
            background-color: var(--primary-bg);
            color: var(--text-primary);
        }
        h1, h2, h3, h4, h5, .display-1, .kpi-value, .btn {
            font-family: var(--font-family-headings);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .dashboard-card {
            background-color: var(--card-bg);
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }
        .hero-widget { color: white; }
        .hero-widget.status-danger { background: linear-gradient(135deg, #dc3545, #a71d2a); }
        .hero-widget.status-ok { background: linear-gradient(135deg, #0d6efd, #074e9e); }
        .hero-widget .display-1 { font-weight: 700; }
        .hero-widget .motivational-text { font-family: var(--font-family-body); text-transform: none; font-size: 1.2rem; opacity: 0.9; letter-spacing: 0; }
        .sidebar .kpi-card .card-body { display: flex; align-items: center; }
        .sidebar .kpi-card .kpi-icon { font-size: 1.8rem; padding: 0.7rem; border-radius: 50%; margin-right: 0.75rem; }
        .sidebar .kpi-card .kpi-value { font-weight: 600; font-size: 1.3rem; }
        .sidebar .kpi-card .kpi-label { color: var(--text-secondary); font-size: 0.8rem; font-family: var(--font-family-body); text-transform: none; letter-spacing: 0;}
        .history-list { max-height: 450px; overflow-y: auto; }
        .history-list .list-group-item:hover { transform: translateX(3px); background-color: #f8f9fa; }
        
        /* --- ESTILO PARA EL NUMERAL --- */
        .training-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            min-width: 40px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-color);
            background-color: var(--accent-color-light);
            border-radius: 50%;
            margin-right: 1rem;
            font-family: var(--font-family-headings);
        }
    </style>
</head>
<body class="p-4">

    <div class="container-fluid">
        <header class="d-flex align-items-center mb-4">
            <i class="bi bi-graph-up-arrow fs-2 me-3 text-primary"></i>
            <h1 class="h2 mb-0">Dashboard de INTERÉS y Frecuencia</h1>
        </header>

        <div class="row">
            <!-- Columna Principal de Análisis -->
            <div class="col-lg-8">
                <!-- Hero Widget -->
                <div id="hero-widget" class="dashboard-card hero-widget status-ok p-4">
                     <div class="row align-items-center text-center">
                        <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
                            <p class="mb-1" style="font-family: var(--font-family-headings); text-transform: uppercase;">Días sin entrenar</p>
                            <div id="hero-days" class="display-1">--</div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
                            <p class="mb-1" style="font-family: var(--font-family-headings); text-transform: uppercase;">Entrenamientos Totales</p>
                            <div id="hero-total-trainings" class="display-1">--</div>
                        </div>
                        <div class="col-lg-4">
                            <p id="hero-motivation" class="motivational-text fst-italic">Calculando...</p>
                        </div>
                    </div>
                </div>

                <!-- Historial Detallado -->
                 <div class="dashboard-card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Historial Detallado</h5>
                        <ul id="training-history-list" class="list-group list-group-flush history-list"></ul>
                    </div>
                </div>
            </div>
            
            <!-- Barra Lateral de Resúmenes -->
            <div class="col-lg-4 sidebar">
                <!-- KPIs -->
                <div class="dashboard-card kpi-card"> <div class="card-body"><i class="bi bi-hourglass-split kpi-icon bg-info-subtle text-info"></i><div><div id="kpi-avg-pause" class="kpi-value">--</div><div class="kpi-label">Pausa Promedio</div></div></div> </div>
                <div class="dashboard-card kpi-card"> <div class="card-body"><i class="bi bi-graph-down-arrow kpi-icon bg-success-subtle text-success"></i><div><div id="kpi-min-pause" class="kpi-value">--</div><div class="kpi-label">Pausa Mínima</div></div></div> </div>
                <div class="dashboard-card kpi-card"> <div class="card-body"><i class="bi bi-graph-up-arrow kpi-icon bg-danger-subtle text-danger"></i><div><div id="kpi-max-pause" class="kpi-value">--</div><div class="kpi-label">Pausa Máxima</div></div></div> </div>
                <div class="dashboard-card kpi-card"> <div class="card-body"><i class="bi bi-fire kpi-icon bg-warning-subtle text-warning"></i><div><div id="kpi-streak" class="kpi-value">--</div><div class="kpi-label">Mejor Racha</div></div></div> </div>
            </div>
        </div>
    </div>

    <!-- Librerías JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const trainingData = [
            { "date": "2025-10-08T18:00:00" }, { "date": "2025-05-14T18:00:00" }, { "date": "2024-10-17T17:00:00" },
            { "date": "2024-08-05T17:00:00" }, { "date": "2024-07-01T17:00:00" }, { "date": "2024-04-03T17:00:00" }, 
            { "date": "2024-02-23T17:00:00" }, { "date": "2024-01-31T17:00:00" }, { "date": "2023-11-09T08:00:00" }, 
            { "date": "2023-08-23T09:00:00" }
        ];

        function getDifferenceInDays(d1, d2) { const msInDay = 1000 * 60 * 60 * 24; return Math.floor((new Date(d2) - new Date(d1)) / msInDay); }
        function formatTimeDifference(days) { if (days < 0) days = 0; if (days < 1) return "Mismo día"; const y = Math.floor(days / 365), m = Math.floor((days % 365) / 30.44), r = Math.floor(days - (y * 365) - (m * 30.44)); const p = []; if (y > 0) p.push(`${y} ${y > 1 ? 'años' : 'año'}`); if (m > 0) p.push(`${m} ${m > 1 ? 'meses' : 'mes'}`); if (r > 0) p.push(`${r} ${r > 1 ? 'días' : 'día'}`); return p.join(', '); }
        function formatTimeAgo(days) { if (days < 1) return "Hoy"; if (days === 1) return "Ayer"; return `Hace ${formatTimeDifference(days)}`; }

        document.addEventListener('DOMContentLoaded', function () {
            const sortedTrainings = trainingData.map(t => new Date(t.date)).sort((a, b) => b - a);
            const now = new Date();
            if (sortedTrainings.length === 0) return;

            // --- Cálculos de KPIs ---
            let totalPauseDays = 0, bestStreak = 0, currentStreak = 0; let minPause = Infinity, maxPause = 0;
            for (let i = 0; i < sortedTrainings.length - 1; i++) {
                const pause = getDifferenceInDays(sortedTrainings[i + 1], sortedTrainings[i]);
                totalPauseDays += pause; if (pause < minPause) minPause = pause; if (pause > maxPause) maxPause = pause;
                if (pause <= 3) { currentStreak++; } else { if (currentStreak > bestStreak) bestStreak = currentStreak; currentStreak = 0; }
            }
            if (currentStreak > bestStreak) bestStreak = currentStreak;
            if (minPause === Infinity) minPause = 0;
            
            // --- Renderizado de KPIs y Widget ---
            const daysSinceLast = getDifferenceInDays(sortedTrainings[0], now);
            let motivationalMessage = '¿Entrenar? Nah, mejor seguir viendo cómo pasa el tiempo.';

            if (daysSinceLast <= 1) { motivationalMessage = '¡Wow, menos de un día! ¿Te hackearon el cuerpo o qué?'; } 
            else if (daysSinceLast <= 3) { motivationalMessage = '¡Dos entrenamientos en una semana! ¿Estás bien? ¿Necesitas ayuda?'; } 
            else if (daysSinceLast <= 7) { motivationalMessage = 'Una semana sin moverse… ¡Eso sí que es un récord de inmovilidad!'; } 
            else if (daysSinceLast <= 30) { motivationalMessage = '¡Felicidades! Has logrado mantener la pereza por casi un mes. Perseverancia nivel experto.'; } 
            else if (daysSinceLast <= 60) { motivationalMessage = 'Más de un mes sin moverte. ¿Te interesa entrenar o estás esperando que el cuerpo se entrene solo por telepatía?'; } 
            else if (daysSinceLast <= 120) { motivationalMessage = 'Dos meses. El nivel de desinterés está alcanzando categoría olímpica. ¿Te aburriste de cuidarte?'; } 
            else if (daysSinceLast <= 240) { motivationalMessage = 'Mas de cuatro meses sin actividad. Ya no es falta de tiempo, es falta de ganas. ¿La motivación se fue de vacaciones permanentes?'; } 
            else if (daysSinceLast <= 365) { motivationalMessage = 'Medio año sin entrenar. El compromiso con la inactividad es admirable. ¿Estás escribiendo una tesis sobre cómo no hacer nada?'; } 
            else { motivationalMessage = 'Un año entero sin moverte. Esto ya no es desinterés, es una filosofía de vida. ¿Te consideras un monumento a la quietud?'; }
            
            document.getElementById('hero-motivation').textContent = motivationalMessage;
            const avgPause = sortedTrainings.length > 1 ? (totalPauseDays / (sortedTrainings.length - 1)).toFixed(1) : 0;
            document.getElementById('hero-total-trainings').textContent = sortedTrainings.length;
            document.getElementById('kpi-avg-pause').textContent = `${avgPause} días`;
            document.getElementById('kpi-min-pause').textContent = `${minPause} días`;
            document.getElementById('kpi-max-pause').textContent = `${maxPause} días`;
            document.getElementById('kpi-streak').textContent = `${bestStreak > 0 ? bestStreak + 1 : 0} seguidos`;
            
            const heroWidget = document.getElementById('hero-widget'); 
            document.getElementById('hero-days').textContent = daysSinceLast; 
            if (daysSinceLast > 30) {
                heroWidget.classList.remove('status-ok');
                heroWidget.classList.add('status-danger');
            }
            
            // --- Renderizado del Historial Detallado ---
            const historyList = document.getElementById('training-history-list'); 
            historyList.innerHTML = ''; 

            sortedTrainings.forEach((date, index) => {
                const li = document.createElement('li'); 
                li.className = 'list-group-item d-flex align-items-center';
                
                const timeAgo = getDifferenceInDays(date, now);
                const timeAgoText = formatTimeAgo(timeAgo);
                let badgeHTML; 
                
                const trainingNumber = sortedTrainings.length - index;

                if (index === sortedTrainings.length - 1) { 
                    badgeHTML = `<span class="badge bg-dark rounded-pill"><i class="bi bi-flag-fill me-1"></i>Primer Entrenamiento</span>`; 
                } else { 
                    const pauseDurationText = formatTimeDifference(getDifferenceInDays(sortedTrainings[index + 1], date));
                    badgeHTML = `<span class="badge bg-secondary rounded-pill"><i class="bi bi-hourglass-split me-1"></i>Pausa: ${pauseDurationText}</span>`; 
                }
                
                // =================================================================
                // CAMBIO: Se usa el nuevo div con la clase 'training-number'
                // =================================================================
                li.innerHTML = `
                    <div class="training-number">${trainingNumber}</div>
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <div class="fw-bold">${date.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                                <small class="text-muted">${date.toLocaleDateString('es-ES', { weekday: 'long' })} &middot; ${timeAgoText}</small>
                            </div>
                            <div class="mt-2 mt-sm-0">
                                ${badgeHTML}
                            </div>
                        </div>
                    </div>
                `; 
                historyList.appendChild(li);
            });
        });
    </script>
</body>
</html>


